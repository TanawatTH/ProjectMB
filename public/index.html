<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
  <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
  <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
  <script src="ejs.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.0/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-firestore.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyDBKnTfXJoRQAjOXaWyItE35Q7qPPdxl70",
      authDomain: "shopee-69f3b.firebaseapp.com",
      databaseURL: "https://shopee-69f3b.firebaseio.com",
      projectId: "shopee-69f3b",
      storageBucket: "shopee-69f3b.appspot.com",
      messagingSenderId: "1025816911376"
    };
    firebase.initializeApp(config);
// Initialize Cloud Firestore through Firebase
var db = firebase.firestore();

// Disable deprecated features
db.settings({
  timestampsInSnapshots: true
});
  </script>

  <style>
    .toolbaricon {
      padding-left: 5px;
      padding-bottom: 5px;
      padding-right: 5px;
      color: orange;
    }
  </style>

  </head>

  <body>
    <ons-navigator swipeable id="myNavigator" page="tab3.html">
      <ons-page>
  
        <ons-toolbar>
          <div class="left">
            <ons-toolbar-button>
              <ons-icon icon="fa-shopping-bag"></ons-icon>
  
            </ons-toolbar-button>
          </div>
          <div class="center" style="text-align:center" id="appname">#</div>
          <div class="right">
            <ons-toolbar-button>
              <ons-icon icon="md-help"></ons-icon>
            </ons-toolbar-button>
          </div>
        </ons-toolbar>
  
        <ons-tabbar swipeable position="auto" id="tabbar">
          <ons-tab page="tab1.html" label="Home" icon="ion-home, material:md-home" badge="7" active>
          </ons-tab>
          <ons-tab page="tab2.html" label="Cart" icon="md-shopping-cart" active-icon="md-shopping-cart">
          </ons-tab>
          <ons-tab page="tab3.html" label="product" icon="md-shopping-cart" active-icon="md-shopping-cart">
          </ons-tab>
         
        </ons-tabbar>
  
      </ons-page>
    </ons-navigator>
  
  
  
    <template id="tab1.html">
      <ons-page>
        <p style="text-align: center; margin-top: 10px;">
          <ons-search-input placeholder="Search" onchange="search(this.value)"></ons-search-input>
        </p>
        <ons-carousel fullscreen swipeable auto-scroll overscrollable id="carousel" style="height: 300px;">
          <ons-carousel-item id="carousel1" style="background: url(1.jpg)no-repeat center;background-size: contain;">
  
          </ons-carousel-item>
          <ons-carousel-item id="carousel2" style="background: url(2.jpg)no-repeat center;background-size: contain;">
  
          </ons-carousel-item>
          <ons-carousel-item id="carousel3" style="background: url(3.jpg)no-repeat center;background-size: contain;">
  
          </ons-carousel-item>
        </ons-carousel>
        <!--/////////////////////////////////////////////////////////////////////////////-->
        <div>
  
  
          <div id="icon"></div>
          <script id="icon_template" type="text/template"> 
                    <ons-row class="category" style="text-align:center">      
                          <% categories.forEach(function(category){%>
                      <ons-col modifier="nodivider" id="  " onclick="changeTab('<%= category.name %>')"width="33%"value="<%= category.name %>">
                          <div class="category_wrapper">
                              <figure class="category_thumbnail">
                                  <ons-icon id="icon1" icon="<%= category.icon %>"></ons-icon>
                                  <div class="category_title" id="Category_1_name"> <%= category.name %> </div>
                              </figure>
                          </div>
                      </ons-col>
  
                      <%});%></div>
                      </Script>
  
  
  
  
</body>
<script>

  getHomeData();
   tatol();
  document.addEventListener('prechange', function (event) {
    if (event.index == 0) {
      console.log('Home clicked');
      // get data for home screen  
      getHomeData();
    } else if (event.index == 1) {
      console.log('Cart clicked');
      // get data for cart screen  
      getCartData();
    }
    else if (event.index == 2) {
      console.log('p clicked');
      var name = localStorage.getItem('name');
      console.log("ffff",name);
      var items = localStorage.getItem('items');
      if (name == null&&items==null) {
        getAllProduct();
      }
      else if (name != null&&items==null){ getAllProduct(name) }
      else if (name != null&&items==null){  }
    }else if (event.index == 3) {
      var title = localStorage.getItem('title');
      console.log('Cart click');
      // test(title)
    }localStorage.clear();
  });
      
   
  function getHomeData() {
    var docRef = db.collection("UI").doc("home");

    docRef.get().then(function (doc) {
      if (doc.exists) {
        console.log("Document data:", doc.data());
        var data = doc.data();
        $('#appname').html(data.appname);
      var style = "background: url('images/" + data.slides[0] + "') no-repeat center; background-size: contain;'";
      $('#carousel1').attr('style', style)
      var icon_template = $('#icon_template').html();
      var html = ejs.render(icon_template, {categories : data.categories});
      $('#icons').html(html)
      } else {
        // doc.data() will be undefined in this case
        console.log("No such document!");
      }
    }).catch(function (error) {
      console.log("Error getting document:", error);
    });

    // $.getJSON('home.json', function (data) {
    //   console.log(data);
    //   $('#appname').html(data.appname);
    //   var style = "background: url('images/" + data.slides[0] + "') no-repeat center; background-size: contain;'";
    //   $('#carousel1').attr('style', style)
    //   var icon_template = $('#icon_template').html();
    //   var html = ejs.render(icon_template, {categories : data.categories});
    //   $('#icons').html(html);
    // });
  }
  function getCartData() {
    var docRef = db.collection("UI").doc("cart");

docRef.get().then(function (doc) {
  if (doc.exists) {
    console.log("Document data:", doc.data());
        var data = doc.data();
  var icon_template = $('#template').html();
  var html = ejs.render(icon_template, {cart: data.cart});
  $('#icon').html(html)
  } else {
    // doc.data() will be undefined in this case
    console.log("No such document!");
  }
}).catch(function (error) {
  console.log("Error getting document:", error);
});

 }
function getAllProduct(){
  var allproductRef = db.collection("PRODUCTS").where("category","==","sport");
  allproductRef.get().then(function(querySnapshot) {
    querySnapshot.forEach(function(doc) {
        // doc.data() is never undefined for query doc snapshots
        console.log(doc.id, " => ", doc.data());
    });
});


}
function addNewData(){
  var data ={
    pid : '4',
    title : 'IPhoneXS',
    price : 50000,
    category : 'electronic'
  }
  db.collection("PRODUCTS").add(data)
  .then(function(docRef) {
    console.log("Document written with ID: ", docRef.id);
})
.catch(function(error) {
    console.error("Error adding document: ", error);
});


}



</script>

</html>